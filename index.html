<html>
<head>
	<script type="text/javascript" src="js/evercookie.js"></script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<title>Hercule VS Evercookie</title>
	<link rel="stylesheet" type="text/css" href="css/custom.css">
</head>
<body>

<h2>uid = <span id="idtag" style="color: red">currently not set</span></h2>

<div id="hydra-heads">
	<div id="localData" class="hydra-head-loading">
		<label>LocalStorage</label>
	</div>
	<div id="sessionData" class="hydra-head-loading">
		<label>SessionStorage</label>
	</div>
	<div id="windowData" class="hydra-head-loading">
		<label>Window name</label>
	</div>
	<div id="dbData" class="hydra-head-loading">
		<label>Web SQL DB</label>
	</div>
	<div id="idbData" class="hydra-head-loading">
		<label>Indexed DB</label>
	</div>
	<div id="cookieData" class="hydra-head-loading">
		<label>HTTP Cookie</label>
	</div>
	<div id="cacheData" class="hydra-head-loading">
		<label>Web Cache</label>
	</div>
	<div id="etagData" class="hydra-head-loading">
		<label>Etags</label>
	</div>
	<div id="pngData" class="hydra-head-loading">
		<label>PNG reading</label>
	</div>
</div>

<script>
	// Name of my tracking field
	let zombieCookieName = 'uid';

	// Instanciating Zombie Cookie
	let zombieCookie = new evercookie({
		history: false,
		java: false,
		silverlight: false,
		lso: false,
		domain: 'localhost',
		publisher: function(item, value) {
			//console.log("publishing item " + item + " = " + value);
			if (document.getElementById(item)) {
				let className = "hydra-head-dead";
				if (value) {
					className = "hydra-head-alive";
				}
				if (document.getElementById(item).className !== className) {
					document.getElementById(item).className = className;
				}
			}
		}
	});

	// Refreshing Zombie Cookie head state
	function refreshZombieCookieState(dont_reset) {
		zombieCookie.get(zombieCookieName, function(best, all) {
			document.getElementById("idtag").innerHTML = best;
		}, dont_reset);
	}

	// Regenerating Zombie Cookie (all heads raising from the death)
	function regenerateZombieCookie() {
		zombieCookie.set(zombieCookieName, document.getElementById('uid').value);
		refreshZombieCookieState(0); // '0' means regeneration of all the dead heads !
	}

	// Refreshing heads every seconds
	setInterval(refreshZombieCookieState, 1000, 1); // '1' means NO regeneration of the dead heads !

</script>

<label for="uid">User ID</label>
<input type="text" name="uid" id="uid" value="1234ABCD"/>
<button onclick="regenerateZombieCookie()">REGENERATE</button>

</body>
</html>
